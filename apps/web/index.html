<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <!-- åŸºæœ¬ SEO Meta æ ‡ç­¾ (ä¸­æ–‡) -->
    <title>Drawnix - å¼€æºç™½æ¿å·¥å…·</title>
    <meta name="description" content="Drawnix æ˜¯ä¸€æ¬¾å¼ºå¤§çš„å¼€æºç™½æ¿å·¥å…·ï¼ˆhttps://github.com/plait-board/drawnixï¼‰ï¼Œé›†æˆæ€ç»´å¯¼å›¾ã€æµç¨‹å›¾ç­‰åŠŸèƒ½ã€‚åŸºäº Plait æ¡†æ¶å¼€å‘ï¼Œæ”¯æŒæ’ä»¶æ‰©å±•ï¼Œæä¾›è‡ªåŠ¨ä¿å­˜ã€æ— é™ç”»å¸ƒç­‰ç‰¹æ€§ã€‚Draw Beyond, Rise Above.">
    <meta name="keywords" content="Drawnix,ç™½æ¿å·¥å…·,ç™½æ¿,æ€ç»´å¯¼å›¾,æµç¨‹å›¾,å¼€æºç™½æ¿,å¼€æºæ€ç»´å¯¼å›¾,åœ¨çº¿ç»˜å›¾,åœ¨çº¿ç™½æ¿,åä½œå·¥å…·,åä½œç™½æ¿,Plait æ¡†æ¶">
    <!-- åŸºæœ¬ SEO Meta æ ‡ç­¾ (è‹±æ–‡) -->
    <meta name="description" lang="en" content="Drawnix is a powerful open-source whiteboard tool featuring mind mapping and flowchart capabilities. Built on the Plait framework, it offers plugin extensibility, auto-save, infinite canvas, and more. Draw Beyond, Rise Above.">
    <meta name="keywords" lang="en" content="Drawnix,whiteboard tool, whiteboard,mind mapping,flowchart,open source whiteboard, open source mind mapping,online drawing,collaboration tool, collaboration whiteboard,Plait framework">
    <!-- Open Graph Meta æ ‡ç­¾ (ä¸­æ–‡) -->
    <meta property="og:title" content="Drawnix - å¼€æºç™½æ¿å·¥å…· | æ€ç»´å¯¼å›¾ | æµç¨‹å›¾ | ç™½æ¿ | åä½œç™½æ¿">
    <meta property="og:description" content="ä¸€ä½“åŒ–å¼€æºç™½æ¿å·¥å…·ï¼ˆåœ¨çº¿ç™½æ¿ | åä½œç™½æ¿ï¼‰ï¼Œæ”¯æŒæ€ç»´å¯¼å›¾ã€æµç¨‹å›¾ï¼ŒåŸºäº Plait æ¡†æ¶å¼€å‘">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://drawnix.com">
    <meta property="og:site_name" content="Drawnix">
    <!-- Open Graph Meta æ ‡ç­¾ (è‹±æ–‡) -->
    <meta property="og:title" lang="en" content="Drawnix - Open Source Whiteboard | Mind Mapping | Flowchart | Whiteboard | Collaboration Whiteboard">
    <meta property="og:description" lang="en" content="An integrated open-source whiteboard tool(online whiteboard | collaboration whiteboard) supporting mind mapping and flowcharts, built on the Plait framework">
    <!-- Twitter Card Meta æ ‡ç­¾ (è‹±æ–‡) -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Drawnix - Open Source Whiteboard | Mind Mapping | Flowchart | Whiteboard | Collaboration Whiteboard">
    <meta name="twitter:description" content="An integrated open-source whiteboard tool(online whiteboard | collaboration whiteboard) supporting mind mapping and flowcharts, built on the Plait framework">
    <!-- PWA Meta æ ‡ç­¾ -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Drawnix">
    <meta name="msapplication-TileColor" content="#2196f3">
    <meta name="theme-color" content="#2196f3">
    
    <!-- PWA å›¾æ ‡å’Œ Manifest -->
    <link rel="manifest" href="/manifest.json">
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="apple-touch-icon" href="/logo/logo_drawnix_h.svg">
    <link rel="mask-icon" href="/logo/logo_drawnix_h.svg" color="#2196f3">
    
    <!-- å…¶ä»–é‡è¦ Meta æ ‡ç­¾ -->
    <meta name="robots" content="index, follow">
    <meta name="author" content="Drawnix Team">
    <link rel="canonical" href="https://drawnix.com">
    <!-- è¯­è¨€æ›¿ä»£é“¾æ¥ -->
    <link rel="alternate" hreflang="zh-CN" href="https://drawnix.com">
    <!-- <link rel="alternate" hreflang="en" href="https://drawnix.com/en"> -->
    <link rel="alternate" hreflang="x-default" href="https://drawnix.com">
    <!-- ç»“æ„åŒ–æ•°æ® (JSON-LD) - ä¸­è‹±åŒè¯­ -->
    <script type="application/ld+json">
        {
          "@context": "https://schema.org",
          "@type": "SoftwareApplication",
          "name": "Drawnix",
          "description": {
            "@language": "zh-CN",
            "@value": "å¼€æºç™½æ¿å·¥å…·ï¼ŒåŒ…å«æ€ç»´å¯¼å›¾ã€æµç¨‹å›¾ç­‰åŠŸèƒ½ã€‚åŸºäº Plait æ¡†æ¶å¼€å‘ï¼Œæ”¯æŒæ’ä»¶æ‰©å±•æœºåˆ¶ã€‚"
          },
          "alternateName": {
            "@language": "en",
            "@value": "Open Source Whiteboard Tool with Mind Mapping and Flowchart capabilities"
          },
          "applicationCategory": "BusinessApplication",
          "operatingSystem": "Web",
          "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "USD"
          },
          "featureList": [
            {
              "@language": "zh-CN",
              "@value": ["æ€ç»´å¯¼å›¾", "æµç¨‹å›¾", "æ’ä»¶æœºåˆ¶", "è‡ªåŠ¨ä¿å­˜", "æ— é™ç”»å¸ƒ", "å¤šç§æ ¼å¼å¯¼å‡º"]
            },
            {
              "@language": "en",
              "@value": ["Mind Mapping", "Flowchart", "Plugin System", "Auto Save", "Infinite Canvas", "Multiple Export Formats"]
            }
          ],
          "softwareVersion": "0.1",
          "license": "https://github.com/plait-board/drawnix/blob/master/LICENSE"
        }
    </script>
    <base href="/" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" type="image/x-icon" href="/favicon.ico" />
    <link rel="stylesheet" href="/src/styles.scss" />
    <script defer src="https://cloud.umami.is/script.js" data-website-id="7083aa92-85b1-4a67-a6d4-03d52819ba3d"></script>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
    
    <!-- PWA Service Worker æ³¨å†Œ -->
    <script>
      // æ³¨å†Œ Service Worker
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('/sw.js')
            .then((registration) => {
              console.log('Service Worker æ³¨å†ŒæˆåŠŸ:', registration.scope);
              
              // æ£€æŸ¥æ›´æ–°
              registration.addEventListener('updatefound', () => {
                const newWorker = registration.installing;
                newWorker.addEventListener('statechange', () => {
                  if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                    // æ–°ç‰ˆæœ¬å¯ç”¨ï¼Œæç¤ºç”¨æˆ·åˆ·æ–°
                    if (confirm('Drawnix æœ‰æ–°ç‰ˆæœ¬å¯ç”¨ï¼Œæ˜¯å¦ç«‹å³æ›´æ–°ï¼Ÿ')) {
                      newWorker.postMessage({ type: 'SKIP_WAITING' });
                      window.location.reload();
                    }
                  }
                });
              });
            })
            .catch((error) => {
              console.log('Service Worker æ³¨å†Œå¤±è´¥:', error);
            });
        });
        
        // ç›‘å¬ Service Worker æ§åˆ¶å™¨å˜åŒ–
        navigator.serviceWorker.addEventListener('controllerchange', () => {
          window.location.reload();
        });
      }
      
      // PWA å®‰è£…æç¤º
      let deferredPrompt;
      let installButton = null;
      
      // å¼ºåˆ¶æ˜¾ç¤ºå®‰è£…æŒ‰é’®ï¼ˆç”¨äºæµ‹è¯•ï¼‰
      function showInstallButton() {
        if (!installButton) {
          installButton = document.createElement('button');
          installButton.textContent = 'ğŸ“± å®‰è£… Drawnix åº”ç”¨';
          installButton.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 10000;
            padding: 12px 16px;
            background: #2196f3;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
            animation: pulse 2s infinite;
          `;
          
          // æ·»åŠ è„‰å†²åŠ¨ç”»
          const style = document.createElement('style');
          style.textContent = `
            @keyframes pulse {
              0% { transform: scale(1); }
              50% { transform: scale(1.05); }
              100% { transform: scale(1); }
            }
          `;
          document.head.appendChild(style);
          
          installButton.addEventListener('click', async () => {
            if (deferredPrompt) {
              deferredPrompt.prompt();
              const { outcome } = await deferredPrompt.userChoice;
              console.log('PWA å®‰è£…ç»“æœ:', outcome);
              deferredPrompt = null;
            } else {
              // å¦‚æœæ²¡æœ‰å®‰è£…æç¤ºäº‹ä»¶ï¼Œæ˜¾ç¤ºæ‰‹åŠ¨å®‰è£…æŒ‡å¯¼
              showManualInstallGuide();
            }
            installButton.remove();
            installButton = null;
          });
          
          document.body.appendChild(installButton);
        }
      }
      
      // æ˜¾ç¤ºæ‰‹åŠ¨å®‰è£…æŒ‡å¯¼
      function showManualInstallGuide() {
        const guide = document.createElement('div');
        guide.innerHTML = `
          <div style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); 
                      z-index: 10001; background: white; padding: 24px; border-radius: 12px;
                      box-shadow: 0 4px 20px rgba(0,0,0,0.3); max-width: 400px;">
            <h3 style="margin: 0 0 16px 0; color: #333;">ğŸ“± å®‰è£… Drawnix PWA</h3>
            <div style="margin-bottom: 16px; line-height: 1.6; color: #666;">
              <strong>Chrome/Edge:</strong><br>
              ç‚¹å‡»åœ°å€æ å³ä¾§çš„å®‰è£…å›¾æ ‡ âŠ•<br><br>
              <strong>æ‰‹æœºæµè§ˆå™¨:</strong><br>
              åœ¨æµè§ˆå™¨èœå•ä¸­é€‰æ‹©"æ·»åŠ åˆ°ä¸»å±å¹•"<br><br>
              <strong>iPhone Safari:</strong><br>
              ç‚¹å‡»åˆ†äº«æŒ‰é’® ğŸ“¤ â†’ "æ·»åŠ åˆ°ä¸»å±å¹•"
            </div>
            <button onclick="this.parentElement.remove()" 
                    style="background: #2196f3; color: white; border: none; 
                           padding: 8px 16px; border-radius: 6px; cursor: pointer;">
              çŸ¥é“äº†
            </button>
          </div>
        `;
        document.body.appendChild(guide);
      }
      
      // é¡µé¢åŠ è½½åæ˜¾ç¤ºå®‰è£…æŒ‰é’®
      window.addEventListener('load', () => {
        setTimeout(showInstallButton, 2000); // 2ç§’åæ˜¾ç¤º
      });
      
      window.addEventListener('beforeinstallprompt', (e) => {
        console.log('PWA å®‰è£…æç¤ºäº‹ä»¶è§¦å‘');
        e.preventDefault();
        deferredPrompt = e;
        
        // åˆ›å»ºå®‰è£…æŒ‰é’®
        if (!installButton) {
          installButton = document.createElement('button');
          installButton.textContent = 'ğŸ“± å®‰è£…åº”ç”¨';
          installButton.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 10000;
            padding: 12px 16px;
            background: #2196f3;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
          `;
          
          installButton.addEventListener('mouseenter', () => {
            installButton.style.transform = 'scale(1.05)';
          });
          
          installButton.addEventListener('mouseleave', () => {
            installButton.style.transform = 'scale(1)';
          });
          
          installButton.addEventListener('click', async () => {
            if (deferredPrompt) {
              deferredPrompt.prompt();
              const { outcome } = await deferredPrompt.userChoice;
              console.log('PWA å®‰è£…ç»“æœ:', outcome);
              
              if (outcome === 'accepted') {
                console.log('ç”¨æˆ·æ¥å—äº† PWA å®‰è£…');
              } else {
                console.log('ç”¨æˆ·æ‹’ç»äº† PWA å®‰è£…');
              }
              
              deferredPrompt = null;
              installButton.remove();
              installButton = null;
            }
          });
          
          document.body.appendChild(installButton);
        }
      });
      
      // æ£€æµ‹åº”ç”¨æ˜¯å¦å·²å®‰è£…
      window.addEventListener('appinstalled', (e) => {
        console.log('PWA å®‰è£…æˆåŠŸ!');
        if (installButton) {
          installButton.remove();
          installButton = null;
        }
        deferredPrompt = null;
        
        // æ˜¾ç¤ºå®‰è£…æˆåŠŸæç¤º
        const toast = document.createElement('div');
        toast.textContent = 'ğŸ‰ Drawnix å·²å®‰è£…åˆ°æ‚¨çš„è®¾å¤‡ï¼';
        toast.style.cssText = `
          position: fixed;
          top: 20px;
          right: 20px;
          z-index: 10001;
          padding: 12px 16px;
          background: #4CAF50;
          color: white;
          border-radius: 8px;
          font-size: 14px;
          box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        `;
        document.body.appendChild(toast);
        
        setTimeout(() => {
          toast.remove();
        }, 3000);
      });
      
      // æ£€æµ‹æ˜¯å¦åœ¨ PWA æ¨¡å¼ä¸‹è¿è¡Œ
      if (window.matchMedia && window.matchMedia('(display-mode: standalone)').matches) {
        console.log('åº”ç”¨æ­£åœ¨ PWA æ¨¡å¼ä¸‹è¿è¡Œ');
        document.documentElement.classList.add('pwa-mode');
      }
      
      // iOS Safari ç‰¹æ®Šå¤„ç†
      if (navigator.userAgent.includes('iPhone') || navigator.userAgent.includes('iPad')) {
        const isInStandaloneMode = window.navigator.standalone;
        if (!isInStandaloneMode && !localStorage.getItem('ios-install-prompt-shown')) {
          setTimeout(() => {
            const iosPrompt = document.createElement('div');
            iosPrompt.innerHTML = `
              <div style="position: fixed; bottom: 20px; left: 20px; right: 20px; z-index: 10000; 
                          background: rgba(0,0,0,0.9); color: white; padding: 16px; border-radius: 12px;
                          font-size: 14px; line-height: 1.4;">
                <div style="margin-bottom: 8px;">ğŸ“± å°† Drawnix æ·»åŠ åˆ°ä¸»å±å¹•ï¼š</div>
                <div style="font-size: 12px; opacity: 0.8;">
                  ç‚¹å‡»åˆ†äº«æŒ‰é’® ğŸ“¤ï¼Œç„¶åé€‰æ‹©"æ·»åŠ åˆ°ä¸»å±å¹•"
                </div>
                <button onclick="this.parentElement.remove(); localStorage.setItem('ios-install-prompt-shown', 'true')"
                        style="position: absolute; top: 8px; right: 12px; background: none; border: none; 
                               color: white; font-size: 18px; cursor: pointer;">Ã—</button>
              </div>
            `;
            document.body.appendChild(iosPrompt);
            
            setTimeout(() => {
              if (iosPrompt.parentElement) {
                iosPrompt.remove();
                localStorage.setItem('ios-install-prompt-shown', 'true');
              }
            }, 10000);
          }, 3000);
        }
      }
    </script>
  </body>
</html>
