<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <!-- 基本 SEO Meta 标签 (中文) -->
    <title>Drawnix - 开源白板工具</title>
    <meta name="description" content="Drawnix 是一款强大的开源白板工具（https://github.com/plait-board/drawnix），集成思维导图、流程图等功能。基于 Plait 框架开发，支持插件扩展，提供自动保存、无限画布等特性。Draw Beyond, Rise Above.">
    <meta name="keywords" content="Drawnix,白板工具,白板,思维导图,流程图,开源白板,开源思维导图,在线绘图,在线白板,协作工具,协作白板,Plait 框架">
    <!-- 基本 SEO Meta 标签 (英文) -->
    <meta name="description" lang="en" content="Drawnix is a powerful open-source whiteboard tool featuring mind mapping and flowchart capabilities. Built on the Plait framework, it offers plugin extensibility, auto-save, infinite canvas, and more. Draw Beyond, Rise Above.">
    <meta name="keywords" lang="en" content="Drawnix,whiteboard tool, whiteboard,mind mapping,flowchart,open source whiteboard, open source mind mapping,online drawing,collaboration tool, collaboration whiteboard,Plait framework">
    <!-- Open Graph Meta 标签 (中文) -->
    <meta property="og:title" content="Drawnix - 开源白板工具 | 思维导图 | 流程图 | 白板 | 协作白板">
    <meta property="og:description" content="一体化开源白板工具（在线白板 | 协作白板），支持思维导图、流程图，基于 Plait 框架开发">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://drawnix.com">
    <meta property="og:site_name" content="Drawnix">
    <!-- Open Graph Meta 标签 (英文) -->
    <meta property="og:title" lang="en" content="Drawnix - Open Source Whiteboard | Mind Mapping | Flowchart | Whiteboard | Collaboration Whiteboard">
    <meta property="og:description" lang="en" content="An integrated open-source whiteboard tool(online whiteboard | collaboration whiteboard) supporting mind mapping and flowcharts, built on the Plait framework">
    <!-- Twitter Card Meta 标签 (英文) -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Drawnix - Open Source Whiteboard | Mind Mapping | Flowchart | Whiteboard | Collaboration Whiteboard">
    <meta name="twitter:description" content="An integrated open-source whiteboard tool(online whiteboard | collaboration whiteboard) supporting mind mapping and flowcharts, built on the Plait framework">
    <!-- PWA Meta 标签 -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Drawnix">
    <meta name="msapplication-TileColor" content="#2196f3">
    <meta name="theme-color" content="#2196f3">
    
    <!-- PWA 图标和 Manifest -->
    <link rel="manifest" href="/manifest.json">
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="apple-touch-icon" href="/logo/logo_drawnix_h.svg">
    <link rel="mask-icon" href="/logo/logo_drawnix_h.svg" color="#2196f3">
    
    <!-- 其他重要 Meta 标签 -->
    <meta name="robots" content="index, follow">
    <meta name="author" content="Drawnix Team">
    <link rel="canonical" href="https://drawnix.com">
    <!-- 语言替代链接 -->
    <link rel="alternate" hreflang="zh-CN" href="https://drawnix.com">
    <!-- <link rel="alternate" hreflang="en" href="https://drawnix.com/en"> -->
    <link rel="alternate" hreflang="x-default" href="https://drawnix.com">
    <!-- 结构化数据 (JSON-LD) - 中英双语 -->
    <script type="application/ld+json">
        {
          "@context": "https://schema.org",
          "@type": "SoftwareApplication",
          "name": "Drawnix",
          "description": {
            "@language": "zh-CN",
            "@value": "开源白板工具，包含思维导图、流程图等功能。基于 Plait 框架开发，支持插件扩展机制。"
          },
          "alternateName": {
            "@language": "en",
            "@value": "Open Source Whiteboard Tool with Mind Mapping and Flowchart capabilities"
          },
          "applicationCategory": "BusinessApplication",
          "operatingSystem": "Web",
          "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "USD"
          },
          "featureList": [
            {
              "@language": "zh-CN",
              "@value": ["思维导图", "流程图", "插件机制", "自动保存", "无限画布", "多种格式导出"]
            },
            {
              "@language": "en",
              "@value": ["Mind Mapping", "Flowchart", "Plugin System", "Auto Save", "Infinite Canvas", "Multiple Export Formats"]
            }
          ],
          "softwareVersion": "0.1",
          "license": "https://github.com/plait-board/drawnix/blob/master/LICENSE"
        }
    </script>
    <base href="/" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" type="image/x-icon" href="/favicon.ico" />
    <link rel="stylesheet" href="/src/styles.scss" />
    <script defer src="https://cloud.umami.is/script.js" data-website-id="7083aa92-85b1-4a67-a6d4-03d52819ba3d"></script>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
    
    <!-- PWA Service Worker 注册 -->
    <script>
      // 注册 Service Worker
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('/sw.js')
            .then((registration) => {
              console.log('Service Worker 注册成功:', registration.scope);
              
              // 检查更新
              registration.addEventListener('updatefound', () => {
                const newWorker = registration.installing;
                newWorker.addEventListener('statechange', () => {
                  if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                    // 新版本可用，提示用户刷新
                    if (confirm('Drawnix 有新版本可用，是否立即更新？')) {
                      newWorker.postMessage({ type: 'SKIP_WAITING' });
                      window.location.reload();
                    }
                  }
                });
              });
            })
            .catch((error) => {
              console.log('Service Worker 注册失败:', error);
            });
        });
        
        // 监听 Service Worker 控制器变化
        navigator.serviceWorker.addEventListener('controllerchange', () => {
          window.location.reload();
        });
      }
      
      // PWA 安装提示
      let deferredPrompt;
      let installButton = null;
      
      // 强制显示安装按钮（用于测试）
      function showInstallButton() {
        if (!installButton) {
          installButton = document.createElement('button');
          installButton.textContent = '📱 安装 Drawnix 应用';
          installButton.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 10000;
            padding: 12px 16px;
            background: #2196f3;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
            animation: pulse 2s infinite;
          `;
          
          // 添加脉冲动画
          const style = document.createElement('style');
          style.textContent = `
            @keyframes pulse {
              0% { transform: scale(1); }
              50% { transform: scale(1.05); }
              100% { transform: scale(1); }
            }
          `;
          document.head.appendChild(style);
          
          installButton.addEventListener('click', async () => {
            if (deferredPrompt) {
              deferredPrompt.prompt();
              const { outcome } = await deferredPrompt.userChoice;
              console.log('PWA 安装结果:', outcome);
              deferredPrompt = null;
            } else {
              // 如果没有安装提示事件，显示手动安装指导
              showManualInstallGuide();
            }
            installButton.remove();
            installButton = null;
          });
          
          document.body.appendChild(installButton);
        }
      }
      
      // 显示手动安装指导
      function showManualInstallGuide() {
        const guide = document.createElement('div');
        guide.innerHTML = `
          <div style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); 
                      z-index: 10001; background: white; padding: 24px; border-radius: 12px;
                      box-shadow: 0 4px 20px rgba(0,0,0,0.3); max-width: 400px;">
            <h3 style="margin: 0 0 16px 0; color: #333;">📱 安装 Drawnix PWA</h3>
            <div style="margin-bottom: 16px; line-height: 1.6; color: #666;">
              <strong>Chrome/Edge:</strong><br>
              点击地址栏右侧的安装图标 ⊕<br><br>
              <strong>手机浏览器:</strong><br>
              在浏览器菜单中选择"添加到主屏幕"<br><br>
              <strong>iPhone Safari:</strong><br>
              点击分享按钮 📤 → "添加到主屏幕"
            </div>
            <button onclick="this.parentElement.remove()" 
                    style="background: #2196f3; color: white; border: none; 
                           padding: 8px 16px; border-radius: 6px; cursor: pointer;">
              知道了
            </button>
          </div>
        `;
        document.body.appendChild(guide);
      }
      
      // 页面加载后显示安装按钮
      window.addEventListener('load', () => {
        setTimeout(showInstallButton, 2000); // 2秒后显示
      });
      
      window.addEventListener('beforeinstallprompt', (e) => {
        console.log('PWA 安装提示事件触发');
        e.preventDefault();
        deferredPrompt = e;
        
        // 创建安装按钮
        if (!installButton) {
          installButton = document.createElement('button');
          installButton.textContent = '📱 安装应用';
          installButton.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 10000;
            padding: 12px 16px;
            background: #2196f3;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
          `;
          
          installButton.addEventListener('mouseenter', () => {
            installButton.style.transform = 'scale(1.05)';
          });
          
          installButton.addEventListener('mouseleave', () => {
            installButton.style.transform = 'scale(1)';
          });
          
          installButton.addEventListener('click', async () => {
            if (deferredPrompt) {
              deferredPrompt.prompt();
              const { outcome } = await deferredPrompt.userChoice;
              console.log('PWA 安装结果:', outcome);
              
              if (outcome === 'accepted') {
                console.log('用户接受了 PWA 安装');
              } else {
                console.log('用户拒绝了 PWA 安装');
              }
              
              deferredPrompt = null;
              installButton.remove();
              installButton = null;
            }
          });
          
          document.body.appendChild(installButton);
        }
      });
      
      // 检测应用是否已安装
      window.addEventListener('appinstalled', (e) => {
        console.log('PWA 安装成功!');
        if (installButton) {
          installButton.remove();
          installButton = null;
        }
        deferredPrompt = null;
        
        // 显示安装成功提示
        const toast = document.createElement('div');
        toast.textContent = '🎉 Drawnix 已安装到您的设备！';
        toast.style.cssText = `
          position: fixed;
          top: 20px;
          right: 20px;
          z-index: 10001;
          padding: 12px 16px;
          background: #4CAF50;
          color: white;
          border-radius: 8px;
          font-size: 14px;
          box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        `;
        document.body.appendChild(toast);
        
        setTimeout(() => {
          toast.remove();
        }, 3000);
      });
      
      // 检测是否在 PWA 模式下运行
      if (window.matchMedia && window.matchMedia('(display-mode: standalone)').matches) {
        console.log('应用正在 PWA 模式下运行');
        document.documentElement.classList.add('pwa-mode');
      }
      
      // iOS Safari 特殊处理
      if (navigator.userAgent.includes('iPhone') || navigator.userAgent.includes('iPad')) {
        const isInStandaloneMode = window.navigator.standalone;
        if (!isInStandaloneMode && !localStorage.getItem('ios-install-prompt-shown')) {
          setTimeout(() => {
            const iosPrompt = document.createElement('div');
            iosPrompt.innerHTML = `
              <div style="position: fixed; bottom: 20px; left: 20px; right: 20px; z-index: 10000; 
                          background: rgba(0,0,0,0.9); color: white; padding: 16px; border-radius: 12px;
                          font-size: 14px; line-height: 1.4;">
                <div style="margin-bottom: 8px;">📱 将 Drawnix 添加到主屏幕：</div>
                <div style="font-size: 12px; opacity: 0.8;">
                  点击分享按钮 📤，然后选择"添加到主屏幕"
                </div>
                <button onclick="this.parentElement.remove(); localStorage.setItem('ios-install-prompt-shown', 'true')"
                        style="position: absolute; top: 8px; right: 12px; background: none; border: none; 
                               color: white; font-size: 18px; cursor: pointer;">×</button>
              </div>
            `;
            document.body.appendChild(iosPrompt);
            
            setTimeout(() => {
              if (iosPrompt.parentElement) {
                iosPrompt.remove();
                localStorage.setItem('ios-install-prompt-shown', 'true');
              }
            }, 10000);
          }, 3000);
        }
      }
    </script>
  </body>
</html>
